<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Elif's Travel History</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      line-height: 1.5;
    }
    header {
      text-align: center;
      padding: 15px;
      background: #fff;
      border-bottom: 1px solid #ddd;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    #map {
      width: 100%;
      height: 400px;
      min-height: 300px;
    }
    #timeline {
      padding: 15px;
      background: #fafafa;
    }
    #timeline h2 {
      margin-top: 0;
    }
    .month-group {
      margin-bottom: 20px;
    }
    .month-group h3 {
      margin: 10px 0;
      border-bottom: 1px solid #ccc;
      padding-bottom: 4px;
    }
    .trip {
      margin: 8px 0;
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
    }
    .trip img {
      width: 50px;
      height: auto;
      border-radius: 4px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    .trip span {
      font-size: 14px;
    }
  </style>
</head>
<body>
<header>
    <h1>üåç Elif's Travel History</h1>
</header>

<div id="map"></div>

<div id="timeline">
    <h2>Chronological Timeline</h2>
    <div id="timeline-content"></div>
</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="data/elif-data.js"></script>
<script>
    const map = L.map('map').setView([35.6895, 139.6917], 3);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // locations is loaded from data/elif-data.js
    
    // Process locations to add date property and full image paths
    locations.forEach(loc => {
        // Extract date from title (format: '... - DD.MM.YYYY')
        const dateMatch = loc.title.match(/(\d{2})\.(\d{2})\.(\d{4})/);
        if (dateMatch) {
            const [_, day, month, year] = dateMatch;
            loc.date = `${year}-${month}-${day}`; // Convert to YYYY-MM-DD format
        }
        
        // Add full image path
        loc.full = `img/elif/${loc.image}`;
    });

    // Sort by date
    locations.sort((a, b) => new Date(a.date) - new Date(b.date));

    // Add markers
    const markers = {};
    locations.forEach(loc => {
        const marker = L.marker(loc.coords).addTo(map);

        marker.bindTooltip(
            `<img src="${loc.full}" style="width:60px;height:auto;border-radius:4px;" />`,
            { direction: "top", opacity: 0.9 }
        );

        marker.bindPopup(
            `<h3>${loc.title}</h3><img src="${loc.full}" style="width:250px;height:auto;" />`
        );

        markers[loc.title] = marker;
    });

    // Group timeline by month
    function formatMonth(dateStr) {
      const options = { year: 'numeric', month: 'long' };
      return new Date(dateStr).toLocaleDateString('en-US', options);
    }

    const timelineContent = document.getElementById('timeline-content');
    let currentMonth = '';
    locations.forEach(loc => {
      const month = formatMonth(loc.date);

      if (month !== currentMonth) {
        currentMonth = month;
        const monthDiv = document.createElement('div');
        monthDiv.className = 'month-group';
        monthDiv.innerHTML = `<h3>${month}</h3>`;
        timelineContent.appendChild(monthDiv);
      }

      const tripDiv = document.createElement('div');
      tripDiv.className = 'trip';
      tripDiv.innerHTML = `<img src="${loc.full}" alt="">
                          <span>${loc.title}</span>`;

      // Click on timeline item -> open popup on map
      tripDiv.addEventListener('click', () => {
        markers[loc.title].openPopup();
        map.setView(loc.coords, 7);
      });

      timelineContent.lastChild.appendChild(tripDiv);
    });
  </script>
    <!-- Country Flags Section -->
    <div style="text-align: center; padding: 20px; margin-top: 30px; border-top: 1px solid #eee;">
        <h3>Countries Visited</h3>
        <div id="country-flags" style="display: flex; justify-content: center; gap: 20px; margin-top: 15px; flex-wrap: wrap;">
        </div>
    </div>
    <script>
        // Country name to ISO code mapping
        const countryToCode = {
            'Afghanistan': 'af', 'Albania': 'al', 'Algeria': 'dz', 'Argentina': 'ar',
            'Armenia': 'am', 'Australia': 'au', 'Austria': 'at', 'Azerbaijan': 'az',
            'Bahamas': 'bs', 'Bahrain': 'bh', 'Bangladesh': 'bd', 'Belarus': 'by',
            'Belgium': 'be', 'Belize': 'bz', 'Bolivia': 'bo', 'Bosnia': 'ba',
            'Brazil': 'br', 'Bulgaria': 'bg', 'Cambodia': 'kh', 'Canada': 'ca',
            'Chile': 'cl', 'China': 'cn', 'Colombia': 'co', 'Croatia': 'hr',
            'Cuba': 'cu', 'Cyprus': 'cy', 'Czech': 'cz', 'Denmark': 'dk',
            'Ecuador': 'ec', 'Egypt': 'eg', 'Estonia': 'ee', 'Ethiopia': 'et',
            'Finland': 'fi', 'France': 'fr', 'Georgia': 'ge', 'Germany': 'de',
            'Ghana': 'gh', 'Greece': 'gr', 'Guatemala': 'gt', 'Honduras': 'hn',
            'Hungary': 'hu', 'Iceland': 'is', 'India': 'in', 'Indonesia': 'id',
            'Iran': 'ir', 'Iraq': 'iq', 'Ireland': 'ie', 'Israel': 'il',
            'Italy': 'it', 'Jamaica': 'jm', 'Japan': 'jp', 'Jordan': 'jo',
            'Kazakhstan': 'kz', 'Kenya': 'ke', 'Korea': 'kr', 'Kuwait': 'kw',
            'Latvia': 'lv', 'Lebanon': 'lb', 'Lithuania': 'lt', 'Luxembourg': 'lu',
            'Malaysia': 'my', 'Maldives': 'mv', 'Malta': 'mt', 'Mexico': 'mx',
            'Monaco': 'mc', 'Mongolia': 'mn', 'Montenegro': 'me', 'Morocco': 'ma',
            'Nepal': 'np', 'Netherlands': 'nl', 'NewZealand': 'nz', 'Nigeria': 'ng',
            'Norway': 'no', 'Oman': 'om', 'Pakistan': 'pk', 'Panama': 'pa',
            'Paraguay': 'py', 'Peru': 'pe', 'Philippines': 'ph', 'Poland': 'pl',
            'Portugal': 'pt', 'Qatar': 'qa', 'Romania': 'ro', 'Russia': 'ru',
            'SaudiArabia': 'sa', 'Serbia': 'rs', 'Singapore': 'sg', 'Slovakia': 'sk',
            'Slovenia': 'si', 'SouthAfrica': 'za', 'Spain': 'es', 'SriLanka': 'lk',
            'Sweden': 'se', 'Switzerland': 'ch', 'Taiwan': 'tw', 'Thailand': 'th',
            'Tunisia': 'tn', 'Turkey': 'tr', 'UAE': 'ae', 'UK': 'gb',
            'Ukraine': 'ua', 'Uruguay': 'uy', 'USA': 'us', 'Uzbekistan': 'uz',
            'Venezuela': 've', 'Vietnam': 'vn'
        };

        // Render flags from elifCountries list
        const flagsContainer = document.getElementById('country-flags');
        elifCountries.forEach(country => {
            const code = countryToCode[country];
            if (code) {
                const flag = document.createElement('div');
                flag.className = `flag-icon flag-icon-circle flag-icon-${code}`;
                flag.title = country;
                flag.style.cssText = 'width: 40px; height: 40px; border-radius: 50%;';
                flagsContainer.appendChild(flag);
            }
        });
    </script>

    <!-- Add flag-icons CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" />
    <style>
        .flag-icon {
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        .flag-icon:hover {
            transform: scale(1.1);
        }
    </style>
</body>
</html>
